const gravity=.3;const bounce=.99;const restitution=1;const radius=15;function resolveCollision(ballA,ballB){const dx=ballB.x-ballA.x;const dy=ballB.y-ballA.y;const dist=Math.hypot(dx,dy);if(dist===0||dist>2*radius)return;const nx=dx/dist;const ny=dy/dist;const dpNormA=ballA.vx*nx+ballA.vy*ny;const dpNormB=ballB.vx*nx+ballB.vy*ny;if(dpNormB>=dpNormA)return;const tx=-ny;const ty=nx;const dpTanA=ballA.vx*tx+ballA.vy*ty;const dpTanB=ballB.vx*tx+ballB.vy*ty;const mA=restitution*dpNormB;const mB=restitution*dpNormA;ballA.vx=tx*dpTanA+nx*mA;ballA.vy=ty*dpTanA+ny*mA;ballB.vx=tx*dpTanB+nx*mB;ballB.vy=ty*dpTanB+ny*mB;const overlap=2*radius-dist;ballA.x-=nx*overlap/2;ballA.y-=ny*overlap/2;ballB.x+=nx*overlap/2;ballB.y+=ny*overlap/2}document.querySelectorAll("svg.ball-box").forEach(svg=>{const balls=[];function createBall(x,y){const ball={x:x,y:y,vx:(Math.random()-.5)*6,vy:(Math.random()-.5)*6,color:randomColor(),elem:document.createElementNS(svgNS,"circle")};ball.elem.setAttribute("r",radius);ball.elem.setAttribute("fill",ball.color);svg.appendChild(ball.elem);return ball}function updateBalls(){for(let i=0;i<balls.length;i++){const ball=balls[i];ball.x+=ball.vx;ball.vy+=.5*gravity;ball.y+=.5*ball.vy;ball.vy+=.5*gravity;ball.y+=.5*ball.vy;if(ball.y+radius>svg.clientHeight&&ball.vy>0){ball.y=svg.clientHeight-radius;ball.vy*=-bounce}if(ball.y-radius<0&&ball.vy<0){ball.y=radius;ball.vy*=-bounce}if(ball.x-radius<0&&ball.vx<0){ball.x=radius;ball.vx*=-bounce}if(ball.x+radius>svg.clientWidth&&ball.vx>0){ball.x=svg.clientWidth-radius;ball.vx*=-bounce}for(let j=i+1;j<balls.length;j++){resolveCollision(ball,balls[j])}ball.elem.setAttribute("cx",ball.x.toFixed(2));ball.elem.setAttribute("cy",ball.y.toFixed(2))}requestAnimationFrame(updateBalls)}svg.addEventListener("click",function(e){const rect=svg.getBoundingClientRect();const x=e.clientX-rect.left;const y=e.clientY-rect.top;balls.push(createBall(x,y))});document.addEventListener("keydown",function(e){if(e.key==="Enter"){balls.push(createBall(svg.clientWidth/2,svg.clientHeight/2))}});updateBalls()});